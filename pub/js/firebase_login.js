function decodeToken(){let base64Url=getCookie("idToken").split('.')[1];let base64=base64Url.replace('-','+').replace('_','/');return JSON.parse(window.atob(base64));};function refreshToken(){firebase.auth().currentUser.getIdToken(true).then(function(token){setCookie("idToken",token);})}
function getParam(p,url){let a=(url!==undefined)?url.substr(url.indexOf("?")+1):window.location.search.substr(1);a=a.split("&");let found="";a.forEach(function(param){param=param.split("=");if(param[0]===p){found=param[1];}});return(found==="")?false:(found===undefined)?true:found;}
firebase.auth().onAuthStateChanged(function(user){if(user){firebase.auth().currentUser.getIdToken(true).then(function(newToken){setCookie("idToken",newToken);});}});function facebookLogin(){var provider=new firebase.auth.FacebookAuthProvider();firebase.auth().signInWithPopup(provider).then(function(data){console.log(data.user);console.log(data.additionalUserInfo);localStorage.setItem("facebookUserInfo",JSON.stringify(data.additionalUserInfo));firebase.auth().currentUser.getIdToken(true).then(function(token){setCookie("idToken",token);token=decodeToken(token);if(token.complete){window.location.replace("https://auth.nauticus.io/mfa");}
else{window.location.replace("/home");}});}).catch(function(err){var errorCode=err.code;var errorMessage=err.message;console.log(errorCode+": "+errorMessage);});}
function twitterLogin(){var provider=new firebase.auth.TwitterAuthProvider();firebase.auth().signInWithPopup(provider).then(function(data){localStorage.setItem("twitterUserInfo",JSON.stringify(data.additionalUserInfo));firebase.auth().currentUser.getIdToken().then(function(token){setCookie("idToken",token);token=decodeToken(token);if(token.complete){window.location.replace("https://auth.nauticus.io/mfa");}
else{window.location.replace("/home");}});}).catch(function(err){var errorCode=err.code;var errorMessage=err.message;console.log(errorCode+": "+errorMessage);});}
$(".facebookLogin").click(function(){facebookLogin();});$(".twitterLogin").click(function(){twitterLogin();});